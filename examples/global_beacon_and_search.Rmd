---
title: "Global Beacon and Global Search"
output:
  html_document:
    df_print: paged
---

## Global Beacon

Global Beacon lets anyone in your organization find datasets based on the entities it contains (i.e. variants, genets, targets). Only datasets that contain entities can be indexed.

```{r}
# Login to SolveBio via API key
library("solvebio")
#login(api_key="YOUR_API_KEY")
```

First let's start with enabling Global Beacon on the dataset:
```{r}
# Dataset ID
dataset_id <- "1676139881237207342"

# Turn on Global Beacon on the selected dataset
Object.enable_global_beacon(dataset_id)
```

Let's check now the status of Glboal Beacon indexing for the datasets:
```{r}
# Waiting for a couple of seconds until indexing is complete
Sys.sleep(20)

# Getting the status of global beacon on the dataset
Object.get_global_beacon_status(dataset_id)
```
As we can see from the response, the indexing in complete. It means that now we can perform search on dataset entities.

Similarly to `enabling` Global Beacon for the datasets, you may also `disable` it using `disable_global_beacon` function:
```
Object.disable_global_beacon("1676139881237207342")
``` 


## Global Search

Global Search allows you to search for vaults, files, folders, and datasets by name, tags, user, date, and other metadata which can be customized.
Global Search is available on SolveBio Mesh. For more information about Global Search please look at [SolveBio docs](https://docs.solvebio.com/search/).

Similarly to Global Search on the web application, the search functionality is available through solvebio R client as well.

#### 1. Global Beacon Search

As we previously indexed the dataset, we should be able to perform entity search and see that dataset in the results
```{r}
response <- GlobalSearch.search('{"entities":[["gene","BRCA2"]]}')
```

Response attributes:
```{r}
names(response)
```

Full response structure:
```{r}
response
```


From the response, we can see that we have 2 results in total (`total` field). Results themselves could be accessed through `results` field in the response.
The total subject count for this search is zero (`subjects_count`).

#### 2. Applying filters for Global Search

Search only for vaults:
```{r}
response <- GlobalSearch.search('{"filters":[{"and":[["type__in",["vault"]]]}]}')
response$results
```

Search based on data created:
```{r}
response <- GlobalSearch.search('{"filters":[{"and":[{"and":[["created_at__range",["2021-12-21","2021-12-28"]]]}]}]}')
response$results
```


#### 3. Advanced search query:
```{r}
response <- GlobalSearch.search('{"query":"fuji"}')
response$total
response$results
```

